name: Sprint PR Title Validation

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  validate-pr-title:
    name: validate-pr-title
    runs-on: ubuntu-latest

    steps:
      - name: Validate PR title for sprint branches
        run: |
          TITLE="${{ github.event.pull_request.title }}"
          BASE_BRANCH="${{ github.event.pull_request.base.ref }}"

          echo "PR Title      : $TITLE"
          echo "Target Branch : $BASE_BRANCH"

          # Sprint branch pattern: sprint-Q1/Q2/Q3/Q4-DD.MM.YY
          if [[ "$BASE_BRANCH" =~ ^sprint-Q[1-4]-[0-9]{2}\.[0-9]{2}\.[0-9]{2}$ ]]; then
            echo "Sprint branch detected. Enforcing PR title rule..."

            if [[ ! "$TITLE" =~ ^(New|Enhancement|Patch)[-:\ ] ]]; then
              echo "❌ PR title must start with New, Enhancement, or Patch for sprint branches"
              echo "Examples:"
              echo "  New: Add export feature"
              echo "  Enhancement - Improve performance"
              echo "  Patch Fix login bug"
              exit 1
            fi

            echo "✅ PR title validation passed for sprint branch"
          else
            echo "Not a sprint branch. Skipping validation."
          fi
