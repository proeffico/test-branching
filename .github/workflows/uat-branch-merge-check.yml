####blocks merges to UAT unless the source branch name matches exactly your rules

# ------------------------------------------------------------
# Workflow name shown in GitHub Actions UI
# ------------------------------------------------------------
name: Validate source branch for UAT

# ------------------------------------------------------------
# Trigger:
# This workflow runs ONLY when a Pull Request
# is created, updated, or reopened with target branch = UAT
# ------------------------------------------------------------
on:
  pull_request:
    branches:
      - UAT

jobs:
  branch-name-check:
    # --------------------------------------------------------
    # Job will run on a GitHub-hosted Linux runner
    # --------------------------------------------------------
    runs-on: ubuntu-latest

    steps:
      # ------------------------------------------------------
      # Step: Validate branch name
      # ------------------------------------------------------
      - name: Validate branch name
        run: |
          # --------------------------------------------------
          # github.head_ref contains the SOURCE branch name
          # (the branch that is trying to merge INTO UAT)
          # --------------------------------------------------
          BRANCH_NAME="${{ github.head_ref }}"
          echo "üîç Checking source branch: $BRANCH_NAME"

          # --------------------------------------------------
          # REGEX defines ALL allowed branch name patterns
          #
          # Allowed formats:
          # 1) sprint-Q[1-4]-dd.mm.yy
          #    - Q must be between 1 and 4
          #    - dd   = 01‚Äì31
          #    - mm   = 01‚Äì12
          #    - yy   = any 2 digits
          #
          # 2) hotfix-functionName-dd.mm.yy
          #    - functionName can contain letters, numbers,
          #      underscore (_) and dash (-)
          # --------------------------------------------------
          REGEX='^(sprint-Q[1-4]-(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.[0-9]{2}|hotfix-[a-zA-Z0-9_-]+-(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.[0-9]{2})$'

          # --------------------------------------------------
          # Check if the source branch name matches the REGEX
          # --------------------------------------------------
          if [[ ! "$BRANCH_NAME" =~ $REGEX ]]; then
            # ----------------------------------------------
            # If branch name does NOT match, fail the job
            # This will block the PR from merging into UAT
            # ----------------------------------------------
            echo "‚ùå ERROR: Branch '$BRANCH_NAME' is NOT allowed to merge into UAT"
            echo ""
            echo "Allowed branch name formats:"
            echo "  - sprint-Q[1-4]-dd.mm.yy"
            echo "  - hotfix-functionName-dd.mm.yy"
            exit 1
          fi

          # --------------------------------------------------
          # If branch name matches the pattern, allow merge
          # --------------------------------------------------
          echo "‚úÖ Branch name is valid. Merge into UAT is allowed."
